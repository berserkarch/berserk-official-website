---
import BaseHead from "../components/BaseHead.astro";
import Footer from "../components/sections/Footer.astro";
import Header from "../components/sections/Header.astro";

interface Props {
  title: string;
  description: string;
  image?: ImageMetadata;
  type?: "website" | "article";
  articleMeta?: {
    publishedTime?: Date;
    modifiedTime?: Date;
    author?: string;
    tags?: string[];
  };
}

const {
  title,
  description,
  image,
  type = "website",
  articleMeta,
} = Astro.props;

const canonicalURL = new URL(Astro.url.pathname, Astro.site);
const imageUrl = image ? new URL(image.src, Astro.site).toString() : undefined;
---

<!doctype html>
<html lang="en" data-theme="dark" class="dark">
  <head>
    <BaseHead title={title} description={description} />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content={type} />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    {imageUrl && <meta property="og:image" content={imageUrl} />}

    <!-- Article specific OG meta -->
    {
      type === "article" && articleMeta && (
        <>
          {articleMeta.publishedTime && (
            <meta
              property="article:published_time"
              content={new Date(articleMeta.publishedTime).toISOString()}
            />
          )}
          {articleMeta.modifiedTime && (
            <meta
              property="article:modified_time"
              content={new Date(articleMeta.modifiedTime).toISOString()}
            />
          )}
          <meta
            property="article:author"
            content={articleMeta.author || "Gaurav Raj"}
          />
          {articleMeta.tags?.map((tag) => (
            <meta property="article:tag" content={tag} />
          ))}
        </>
      )
    }

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    {imageUrl && <meta name="twitter:image" content={imageUrl} />}

    <!-- JSON-LD: Article -->
    {
      type === "article" && articleMeta && (
        <script
          type="application/ld+json"
          set:html={JSON.stringify({
            "@context": "https://schema.org",
            "@type": "Article",
            headline: title,
            description,
            image: imageUrl,
            datePublished: articleMeta.publishedTime
              ? new Date(articleMeta.publishedTime).toISOString()
              : undefined,
            dateModified: articleMeta.modifiedTime
              ? new Date(articleMeta.modifiedTime).toISOString()
              : undefined,
            author: [
              {
                "@type": "Person",
                name: articleMeta.author || "Gaurav Raj",
              },
            ],
            publisher: {
              "@type": "Organization",
              name: "Gaurav Raj",
              url: new URL("/", Astro.site).toString(),
            },
            mainEntityOfPage: canonicalURL.toString(),
            url: canonicalURL.toString(),
          })}
        />
      )
    }

    <!-- JSON-LD: Breadcrumbs (for articles) -->
    {
      type === "article" && (
        <script
          type="application/ld+json"
          set:html={JSON.stringify({
            "@context": "https://schema.org",
            "@type": "BreadcrumbList",
            itemListElement: [
              {
                "@type": "ListItem",
                position: 1,
                name: "Home",
                item: new URL("/", Astro.site).toString(),
              },
              {
                "@type": "ListItem",
                position: 2,
                name: "Blog",
                item: new URL("/blog/", Astro.site).toString(),
              },
              {
                "@type": "ListItem",
                position: 3,
                name: title,
                item: canonicalURL.toString(),
              },
            ],
          })}
        />
      )
    }

    <!-- JSON-LD: Organization -->
    <script
      type="application/ld+json"
      set:html={JSON.stringify({
        "@context": "https://schema.org",
        "@type": "Organization",
        name: "Gaurav Raj",
        url: new URL("/", Astro.site).toString(),
        logo: new URL("/favicon.svg", Astro.site).toString(),
        sameAs: [
          "https://x.com/thehackersbrain",
          "https://github.com/thehackersbrain/",
          "https://thehackersbrain.dev/",
        ],
      })}
    />
  </head>

  <body
    style="background: radial-gradient(ellipse at top, #26282b 0%, #1d1e22 60%, #16171b 100%); background-attachment: fixed; background-size: 100vw 100vh;"
  >
    <Header />
    <main>
      <slot />
    </main>
    <Footer />
  </body>
</html>
